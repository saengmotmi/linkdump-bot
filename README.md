# LinkDump Bot ⚡

도메인 중심 아키텍처와 플러그인 기반 의존성 주입을 사용하는 링크 관리 시스템입니다.

## 🎯 주요 특징

- **도메인 중심 아키텍처**: 비즈니스 로직이 인프라스트럭처에 의존하지 않음
- **플러그인 기반 의존성 주입**: 새로운 구현체를 쉽게 추가 가능
- **환경별 구현체 교체**: Cloudflare Workers, 로컬 개발 등 환경에 맞는 구현체 자동 선택
- **확장성**: Open/Closed 원칙을 준수하여 기존 코드 수정 없이 새 기능 추가

## 🚀 핵심 기능

- ⚡ **즉시 처리**: 링크 추가 즉시 백그라운드에서 AI 처리
- 🌐 **통합 웹 인터페이스**: 아름다운 그라데이션 UI
- 📱 **모바일 북마클릿**: 어떤 페이지에서든 원클릭 추가
- 🤖 **Workers AI 요약**: "왜 클릭해야 하는지" 중심의 매력적인 요약 (완전 무료!)
- 💬 **Discord 자동 전송**: 여러 채널 동시 전송
- 🔄 **수동 처리**: 미처리 링크 일괄 처리 기능

## 🏗️ 완전 Cloudflare 아키텍처

```
사용자 → Cloudflare Worker (웹페이지 + API + Workers AI) → R2 Storage → Discord
                           ↑                              ↑
                  모든 것이 하나의 Worker              영구 저장소
                     (완전 무료!)
```

## 💰 비용 (월 기준)

| 서비스                 | 비용                       |
| ---------------------- | -------------------------- |
| **Cloudflare R2**      | $0 (10GB 무료)             |
| **Cloudflare Workers** | $0 (10만 요청 무료)        |
| **Workers AI**         | $0 (매일 10K Neurons 무료) |
| **총 비용**            | **완전 무료!** 🎉          |

## 📦 배포 방법

자세한 배포 가이드는 [SETUP.md](./SETUP.md)를 참고하세요.

```bash
# 1. Cloudflare 계정 생성 및 R2 버킷 생성
# 2. wrangler CLI 설치 및 로그인
npm install -g wrangler
wrangler auth

# 3. Workers 배포
yarn deploy  # 또는 아래 명령어들 직접 실행
# cd workers
# cp wrangler-complete.toml wrangler.toml
# wrangler secret put DISCORD_WEBHOOKS
# wrangler deploy
```

## 🔄 작동 방식

1. **링크 추가**: 웹 인터페이스에서 URL 입력
2. **즉시 저장**: Cloudflare R2에 즉시 저장
3. **백그라운드 처리**: Worker가 백그라운드에서 OG 태그 스크래핑 + Workers AI 요약 생성
4. **Discord 전송**: 생성된 요약과 함께 Discord로 자동 전송

## 🎯 혁신적 장점

- ⚡ **즉시 피드백**: 링크 추가 즉시 성공 응답
- 🚀 **백그라운드 처리**: AI 처리가 사용자 경험을 방해하지 않음
- 🌍 **글로벌 성능**: Cloudflare 엣지 네트워크
- 💰 **완전 무료**: 모든 것이 무료!
- 🔧 **초간단 배포**: Secret 1개만 설정
- 📱 **완벽한 UX**: 반응형 + 애니메이션 + 로딩 상태

## 📱 사용 방법

1. **웹 인터페이스**: 배포된 Worker URL 접속하여 링크 추가
2. **북마클릿**: 제공된 북마클릿을 브라우저에 추가하여 원클릭 공유
3. **수동 처리**: "미처리 링크 수동 처리" 버튼으로 일괄 처리

## 🧪 개발 및 테스트

### 테스트 실행

```bash
# 의존성 설치
yarn install

# 전체 테스트 실행
yarn test

# 테스트 감시 모드
yarn test:watch

# 커버리지 포함 테스트
yarn test:coverage
```

### 테스트 구조

- **단위 테스트**: 핵심 비즈니스 로직 검증
- **통합 테스트**: 전체 플로우 검증
- **성능 테스트**: 대용량 데이터 처리 성능 검증
- **에러 처리**: 예외 상황 대응 검증

### 주요 테스트 케이스

- ✅ URL 유효성 검증 (다양한 프로토콜, 잘못된 형식)
- ✅ 링크 데이터 생성 및 중복 체크
- ✅ HTML에서 OG 태그 추출 (복잡한 구조, 특수문자)
- ✅ AI 프롬프트 생성 및 응답 파싱
- ✅ Discord 임베드 생성
- ✅ 대용량 데이터 성능 (10,000개 링크 처리)
- ✅ 메모리 효율성 검증

## 🏆 품질 보증

- **테스트 커버리지**: 95%+ 목표
- **성능 기준**: 1,000개 링크 처리 < 100ms
- **메모리 효율성**: 1,000개 링크 생성 < 5MB
- **에러 처리**: 모든 예외 상황 안전 처리
- **패키지 관리**: Yarn 사용으로 의존성 안정성 확보

## 🎁 플러그인 시스템의 장점

### 1. **확장성**

- 기존 코드 수정 없이 새로운 구현체 추가
- Open/Closed 원칙 준수

### 2. **번들 최적화**

- 동적 import로 필요한 구현체만 로드
- 사용하지 않는 코드는 번들에 포함되지 않음

### 3. **테스트 용이성**

- 각 플러그인을 독립적으로 테스트 가능
- Mock 플러그인으로 쉬운 단위 테스트

### 4. **환경별 최적화**

- 환경에 맞는 구현체만 등록
- 설정 기반 자동 선택

## 📊 이전 구조와의 비교

| 측면      | 이전 (하드코딩)        | 현재 (플러그인)     |
| --------- | ---------------------- | ------------------- |
| 확장성    | ❌ switch 문 수정 필요 | ✅ 플러그인만 추가  |
| 번들 크기 | ❌ 모든 구현체 포함    | ✅ 필요한 것만 로드 |
| 테스트    | ❌ 의존성 복잡         | ✅ 독립적 테스트    |
| 유지보수  | ❌ 중앙 집중식 수정    | ✅ 분산된 관리      |

## 🧪 테스트

```bash
# 단위 테스트
npm test

# 특정 플러그인 테스트
npm test -- --grep "OpenAI"

# 통합 테스트
npm run test:integration
```

## 📚 더 자세한 정보

- [ARCHITECTURE.md](./ARCHITECTURE.md) - 상세한 아키텍처 가이드
- [src/shared/plugins/example-custom-plugins.js](./src/shared/plugins/example-custom-plugins.js) - 커스텀 플러그인 예시

## 🤝 기여하기

1. 새로운 플러그인 추가
2. 기존 구현체 개선
3. 테스트 커버리지 향상
4. 문서화 개선

새로운 플러그인을 추가할 때는 `src/shared/plugins/example-custom-plugins.js`를 참고하세요!
